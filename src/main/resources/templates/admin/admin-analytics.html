<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Analytics ‚Äì Hamro Chalchitraghar</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="p-4 bg-light">
<div class="container">

    <h2 class="text-center mb-4">üé¨ Movie & Show Analytics</h2>

    <div class="row text-center mb-4">
        <div class="col-md-3"><div class="card"><div class="card-body">
            <h6>Total Bookings</h6><h3 th:text="${totalBookings}"></h3>
        </div></div></div>

        <div class="col-md-3"><div class="card"><div class="card-body">
            <h6>Total Movies</h6><h3 th:text="${totalMovies}"></h3>
        </div></div></div>

        <div class="col-md-3"><div class="card"><div class="card-body">
            <h6>Total Customers</h6><h3 th:text="${totalCustomers}"></h3>
        </div></div></div>

        <div class="col-md-3"><div class="card"><div class="card-body">
            <h6>Total Revenue (‚Ç®)</h6>
            <h3 th:text="${#numbers.formatDecimal(totalRevenue,0,'COMMA',0,'POINT')}"></h3>
        </div></div></div>
    </div>

    <div class="card shadow-sm mb-4 p-3">
        <h5 class="text-center mb-3">üìä Bookings per Movie</h5>
        <canvas id="bookingChart" height="120"></canvas>
    </div>

    <div class="card shadow-sm mb-4 p-3">
        <h5 class="text-center mb-3">üí∞ Revenue per Movie (‚Ç®)</h5>
        <canvas id="revenueChart" height="120"></canvas>
    </div>

    <div class="card shadow-sm p-3">
        <h5 class="text-center mb-3">üèÜ Top 5 Movies by Bookings</h5>
        <ul class="list-group">
            <li class="list-group-item d-flex justify-content-between align-items-center"
                th:each="entry : ${top5Movies}">
                <span th:text="${entry.key}"></span>
                <span class="badge bg-primary rounded-pill"
                      th:text="${entry.value}"></span>
            </li>
        </ul>
    </div>

</div>

<script th:inline="javascript">
    const movieNames = [[${movieBookings.keySet()}]];
    const bookingCounts = [[${movieBookings.values()}]];
    const revenueData = [[${movieRevenue.values()}]];

    new Chart(document.getElementById('bookingChart'), {
        type: 'bar',
        data: {
            labels: movieNames,
            datasets: [{
                label: 'Bookings',
                data: bookingCounts,
                backgroundColor: '#007bff'
            }]
        },
        options: { responsive: true, plugins: { legend: { display: false } } }
    });

    new Chart(document.getElementById('revenueChart'), {
        type: 'line',
        data: {
            labels: movieNames,
            datasets: [{
                label: 'Revenue (‚Ç®)',
                data: revenueData,
                borderColor: '#28a745',
                fill: false,
                tension: 0.3
            }]
        },
        options: { responsive: true, plugins: { legend: { display: false } } }
    });
</script>
</body>
</html>
